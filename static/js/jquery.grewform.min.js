/*
 * jQuery GrewForm Plugin v0.4.0.1
 *
 * Copyright 2011, Artem Suschev
 * Grandcapital Ltd.
 *  
 * Licensed under the MIT license (license.txt)
 */
(function(){jQuery.fn.grewform=function(p,l){jQuery("input,textarea").live("keyup change",function(s){var q=[16,9,33,34,36,35,45,38,40,37,39];if(s.keyCode&&jQuery.inArray(s.keyCode,q)<0){var r=d(this);jQuery(this).attr("value",this.value);a(this,r)}});var n=this;for(var k in p){var o=new b(k,n,p[k])}n.find("*").keyup(function(){var q=setInterval(function(){clearInterval(q);i()},300)});jQuery(document).ready(function(){i()});f();if(l&&l.effects){for(var m in l){f[m]=l[m]}}return n.find("*").change(function(){i()})};function f(){f.effects={show:"slideDown",hide:"slideUp"}}jQuery.fn.grewform.reset=function(){b.id=undefined;b.all=[]};jQuery.fn.grewform.runRules=function(){i()};function c(k){}function i(){jQuery.each(b.all,function(k,l){(function(n){var m=setInterval(function(){try{if(!b.form.find("*").is(":animated")){clearInterval(m);if(n.unmatches()){n.run_unmatch_actions()}}}catch(o){clearInterval(m)}},200)}(l))});jQuery.each(b.all,function(k,l){(function(n){var m=setInterval(function(){try{if(!b.form.find("*").is(":animated")){clearInterval(m);if(n.matches()){n.run_match_actions()}}}catch(o){clearInterval(m)}},200)}(l))})}function b(l,n,k){if(typeof b.id=="undefined"){b.id=0;b.blip_ptr="hgo_grewform_rule";b.unmtach_by_blip=function(o){jQuery.each(b.all,function(p,q){if(q.blip===o){q.run_unmatch_actions()}})};b.all=[];b.form=n}this.id=b.id;b.id=b.id+1;this.blip=b.blip_ptr+this.id;this.selectors=h((""+l).split("AND"));jQuery.each(this.selectors,function(o){return function(q,p){o[q]=jQuery.trim(""+p)}}(this.selectors));this.selector=j(this.selectors);this.trigged=false;this.match_actions=[];this.unmatch_actions=[];this.raw=k;this.raw_selector=l;for(var m in k){e(m,n,this)}this.matches=function(){for(var p=0;p<this.selectors.length;p++){var o=this.selectors[p];if((!this.trigged)){if(b.form.find(o).filter("option:first").length>0){if(b.form.find(o).parent("select:visible:first").length===0){return false}}else{if(b.form.find(o).filter(":visible:first,input[type=hidden]:first").length===0){return false}}}else{return false}}return true};this.unmatches=function(){if(!this.trigged){return false}for(var p=0;p<this.selectors.length;p++){var o=this.selectors[p];if(b.form.find(o+":first").length===0){return true}}return false};this.run_match_actions=function(){c("match: "+this.raw_selector);this.trigged=true;b.form.find(this.selector).addClass(this.blip);for(var o=0;o<this.match_actions.length;o++){var p=this.match_actions[o];p.call(this)}};this.run_match_actions.first_run=true;this.run_unmatch_actions=function(){c("unmatch: "+this.raw_selector);this.trigged=false;jQuery("."+this.blip).removeClass(this.blip);for(var o=0;o<this.unmatch_actions.length;o++){var p=this.unmatch_actions[o];p.call(this)}};b.all.push(this)}function e(n,o,p){switch(n){case"show":p.match_actions.push(function(q){return function(){if(q.is("option")){q.show()}else{q[f.effects.show]()}}}(o.find(p.raw[n])));p.unmatch_actions.push(function(q){return function(){g(q);if(q.is("option")){q.hide()}else{q[f.effects.hide]()}}}(o.find(p.raw[n])));break;case"hide":p.match_actions.push(function(q){return function(){if(q.is("option")){q.hide()}else{q[f.effects.hide]()}}}(o.find(p.raw[n])));p.unmatch_actions.push(function(q){return function(){g(q);if(q.is("option")){q.show()}else{q[f.effects.show]()}}}(o.find(p.raw[n])));break;case"set_value":p.match_actions.push(function(q){return function(){var r=this;jQuery.each(q,function(s,t){jQuery.each(b.form.find(s),function(){var u=jQuery(this).tagName;if(u=="select"){if(r.run_match_actions.first_run){r.unmatch_actions.push(function(v,w){return function(){g(v);w.attr("selected","selected")}}(elems.find("option [value="+t+"]"),elems.find("option:selected")))}elems.find("option").removeAttr("selected");elems.find("option [value="+t+"]").attr("selected","selected")}else{if(r.run_match_actions.first_run){r.unmatch_actions.push(function(w,v){return function(){g(w);w.val(v)}}(jQuery(s),jQuery(s).val()))}jQuery(s).val(t)}})});r.run_match_actions.first_run=false}}(p.raw[n]));break;case"add_options":for(var k in p.raw[n]){var m=p.raw[n][k];if(typeof m=="function"){p.match_actions.push(function(s,q,r){return function(){var u=r();for(var t in u){var w=s.find(q);jQuery("<option></option>").html(u[t]).val(t).appendTo(w)}if(this.run_match_actions.first_run){for(var t in u){this.unmatch_actions.push(function(z,x,y){return function(){g(z.children(x).children("option[value="+y+"]"));z.find(x).children().remove("option[value="+y+"]")}}(o,q,t))}this.run_match_actions.first_run=false}}}(o,k,m))}else{for(var l in m){p.match_actions.push(function(t,q,r,s){return function(){var u=t.find(q);jQuery("<option></option>").html(s).val(r).appendTo(u)}}(o,k,l,m[l]));p.unmatch_actions.push(function(s,q,r){return function(){g(s.children(q).children("option[value="+r+"]"));s.find(q).children().remove("option[value="+r+"]")}}(o,k,l))}}}break;case"disable":p.match_actions.push(function(q){return function(){q.attr("disabled","disabled")}}(o.find(p.raw[n])));p.unmatch_actions.push(function(q){return function(){g(q);q.removeAttr("disabled")}}(o.find(p.raw[n])));break;case"enable":p.match_actions.push(function(q){return function(){q.removeAttr("disabled")}}(o.find(p.raw[n])));p.unmatch_actions.push(function(q){return function(){g(q);q.attr("disabled","disabled")}}(o.find(p.raw[n])));break;case"check":p.match_actions.push(function(q){return function(){q.attr("checked","checked")}}(o.find(p.raw[n])));p.unmatch_actions.push(function(q){return function(){g(q);q.removeAttr("checked")}}(o.find(p.raw[n])));break;case"uncheck":p.match_actions.push(function(q){return function(){q.removeAttr("checked")}}(o.find(p.raw[n])));p.unmatch_actions.push(function(q){return function(){g(q);q.attr("checked","checked")}}(o.find(p.raw[n])));break;case"set_html":p.match_actions.push(function(q){return function(){var r=this;jQuery.each(q,function(s,t){jQuery.each(b.form.find(s),function(){if(r.run_match_actions.first_run){r.unmatch_actions.push(function(u,v){return function(){g(u);u.html(v)}}(jQuery(s),jQuery(s).html()))}jQuery(s).html(t)})});r.run_match_actions.first_run=false}}(p.raw[n]));break;case"custom":p.match_actions.push(function(r,q){return function(){r.call(q)}}(p.raw[n]["match"],jQuery(p.selector)));p.unmatch_actions.push(function(r,q){return function(){r.call(q)}}(p.raw[n]["unmatch"],jQuery(p.selector)));break;default:return}}function g(k){jQuery.each(k,function(){var m=jQuery(this);if(m.attr("class")!==undefined){var l=m.attr("class").split(" ");jQuery.each(l,function(o,n){b.unmtach_by_blip(n)})}g(m.children())})}function h(k){if(k.constructor!==Array){return[k]}return k}function j(k){res="";for(var l=0;l<k.length;l++){res+=jQuery.trim(""+k[l])+","}return res}function d(l){var m=0;if(document.selection){l.focus();var k=document.selection.createRange();k.moveStart("character",-l.value.length);m=Sel.text.length}else{if(l.selectionStart||l.selectionStart=="0"){m=l.selectionStart}}return(m)}function a(l,m){if(l.setSelectionRange){l.focus();l.setSelectionRange(m,m)}else{if(l.createTextRange){var k=l.createTextRange();k.collapse(true);k.moveEnd("character",m);k.moveStart("character",m);k.select()}}}})();